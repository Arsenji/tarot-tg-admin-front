<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</title>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ Telegram WebApp</h1>
    <div id="status">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
    <script>
        // –ú–æ–∫ Telegram WebApp –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.Telegram = {
            WebApp: {
                initData: 'user=%7B%22id%22%3A399476674%2C%22first_name%22%3A%22Arsenij%22%2C%22last_name%22%3A%22Berdnikov%22%2C%22username%22%3A%22arsenji%22%7D&chat_instance=&chat_type=&auth_date=$(date +%s)&hash=test_hash_signature'
            }
        };
        
        console.log('üîç Telegram WebApp –º–æ–∫ —Å–æ–∑–¥–∞–Ω:', window.Telegram.WebApp.initData);
        
        // –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
        async function testAuth() {
            try {
                const initData = window.Telegram.WebApp.initData;
                document.getElementById('status').innerHTML = 'üîê –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...';
                
                const response = await fetch('/api/auth/telegram', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ initData })
                });
                
                const data = await response.json();
                console.log('üìã –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', data);
                
                if (data.success) {
                    document.getElementById('status').innerHTML = '‚úÖ –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –¢–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω.';
                    localStorage.setItem('authToken', data.data.token);
                    console.log('üíæ –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', data.data.token.substring(0, 50) + '...');
                } else {
                    document.getElementById('status').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: ' + data.error;
                }
            } catch (error) {
                console.error('üö® –û—à–∏–±–∫–∞:', error);
                document.getElementById('status').innerHTML = '‚ö†Ô∏è Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ' + error.message;
            }
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
        setTimeout(testAuth, 1000);
    </script>
</body>
</html>
