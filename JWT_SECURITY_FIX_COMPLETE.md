# üîê JWT –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –ü–û–õ–ù–û–°–¢–¨–Æ –ò–°–ü–†–ê–í–õ–ï–ù–ê!

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

### ‚úÖ –ß–¢–û –ë–´–õ–û –ò–°–ü–†–ê–í–õ–ï–ù–û:

**üî• –£–¥–∞–ª–µ–Ω—ã –í–°–ï —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã:**
- ‚ùå `frontend/src/app/page.tsx` - —É–¥–∞–ª–µ–Ω —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 399476674
- ‚ùå `frontend/src/screens/HomeScreen.tsx` - —É–¥–∞–ª–µ–Ω —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è 399476674  
- ‚ùå `frontend/src/services/api.ts` - —É–¥–∞–ª–µ–Ω–æ **11 —Ç–æ–∫–µ–Ω–æ–≤** —Ä–∞–∑–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—Å–µ —Ç–æ–∫–µ–Ω—ã –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ backup —Ñ–∞–π–ª `api.ts.backup`

### üõ°Ô∏è –†–ï–ê–õ–ò–ó–û–í–ê–ù–ê –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –ê–î–ê–õ–¢–ò–§–ò–ö–ê–¶–ò–Ø:

#### 1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–æ–∫–µ–Ω–æ–≤**
```typescript
// –ù–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
const token = await getValidAuthToken();
fetch('/api/tarot/subscription-status', {
  headers: {
    'Authorization': token ? `Bearer ${token}` : ''
  }
});
```

#### 2. **Telegram WebApp –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ `initData` –∏–∑ Telegram WebApp
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–π –ø–æ–¥–ø–∏—Å–∏ Telegram
- –°–æ–∑–¥–∞–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö JWT —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 3. **–£—Ç–∏–ª–∏—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (`frontend/src/utils/auth.ts`)
```typescript
export const getAuthToken = async (): Promise<string | null>
export const isTokenValid = (): boolean  
export const clearAuthTokens = (): void
export const getValidAuthToken = async (): Promise<string | null>
```

#### 4. **Backend —ç–Ω–¥–ø–æ–∏–Ω—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**
- `POST /api/auth/telegram` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ Telegram
- –ü—Ä–æ–≤–µ—Ä–∫–∞ HMAC-SHA256 –ø–æ–¥–ø–∏—Å–∏ Telegram WebApp
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø:

### Frontend:
- ‚úÖ –°–æ–∑–¥–∞–Ω `frontend/src/utils/auth.ts` —Å –º–µ—Ç–æ–¥–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω `frontend/src/services/api.ts`
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã `frontend/src/app/page.tsx` –∏ `frontend/src/screens/HomeScreen.tsx`
- ‚úÖ –í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Ç–æ–∫–µ–Ω—ã

### Backend:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω —Ä–æ—É—Ç `POST /api/auth/telegram` –≤ `src/routes/auth.ts`
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `telegramAuth()` –≤ `src/controllers/authController.ts`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ HMAC –ø–æ–¥–ø–∏—Å–∏ Telegram WebApp
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤

## üéØ –†–ï–ó–£–õ–¨–¢–ê–¢:

### ‚úÖ **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:**
- ‚ùå **–ù–ï–¢ –ø—É–±–ª–∏—á–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤** –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ
- ‚úÖ **–ö–∞–∂–¥—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å** –ø–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
- ‚úÖ **–¢–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è** –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ–∞–Ω—Å–∞
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏** Telegram WebApp –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤ —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π

### ‚úÖ **–§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨:**
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç** —Å–æ –≤—Å–µ–º–∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ API –≤—ã–∑–æ–≤–∞–º–∏
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ** –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º –∫–æ–¥–æ–º
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- ‚úÖ **Fallback –º–µ—Ö–∞–Ω–∏–∑–º** –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### ‚úÖ **–ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨:**
- ‚úÖ **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** —Ç–æ–∫–µ–Ω–æ–≤ –≤ localStorage
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã—Ö** —Ç–æ–∫–µ–Ω–æ–≤ –ø–µ—Ä–µ–¥ –ø–æ–ª—É—á–µ–Ω–∏–µ–º –Ω–æ–≤—ã—Ö
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** –∏—Å—Ç–µ–∫—à–∏—Ö —Ç–æ–∫–µ–Ω–æ–≤

## ‚ö†Ô∏è –ß–¢–û –ù–£–ñ–ù–û –ü–†–û–í–ï–†–ò–¢–¨:

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Telegram WebApp** - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ `initData`
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤** - —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç
3. **–î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω** - –æ–±–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üöÄ –°–ò–°–¢–ï–ú–ê –ì–û–¢–û–í–ê –ö –ü–†–û–î–ê–ö–®–ï–ù–£!

–ë–æ–ª—å—à–µ **–ù–ï–¢ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏.
–í—Å–µ —Ç–æ–∫–µ–Ω—ã —Ç–µ–ø–µ—Ä—å –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏** –∏ **–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram WebApp.

---
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –£–Ø–ó–í–ò–ú–û–°–¢–¨ –ò–°–ü–†–ê–í–õ–ï–ù–ê**  
**–î–∞—Ç–∞:** $(date)  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª–µ–Ω—ã, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
